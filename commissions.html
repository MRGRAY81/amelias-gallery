<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Contact ‚Äî Amelia‚Äôs Gallery</title>
  <meta name="description" content="Contact & commission requests ‚Äî Amelia‚Äôs Gallery (family managed)." />
  <link rel="stylesheet" href="./styles.css?v=5" />
</head>

<body data-page="contact">

  <!-- üå∏ Japanese Header -->
  <header class="image-header">
    <img src="./amelias-gallery-header.png" alt="Amelia‚Äôs Gallery">

    <!-- üéØ Hidden tower login -->
    <a href="./admin.html" class="tower-login" aria-label="Admin Login"></a>
  </header>

  <!-- üå∏ Navigation -->
  <nav class="nav nav-buttons" aria-label="Primary">
    <a class="btnlink" href="./index.html">Home</a>
    <a class="btnlink" href="./gallery.html">Gallery</a>
    <a class="btnlink active" href="./commissions.html">Contact</a>
    <a class="btnlink" href="./about.html">About</a>
  </nav>

  <main class="shell">

    <section class="section">
      <div class="section-head">
        <h2>Contact ‚ú®</h2>
        <p>For commission requests or enquiries ‚Äî a grown-up will reply.</p>
      </div>

      <div class="panel">
        <h3>Message Amelia‚Äôs Gallery</h3>
        <p class="muted">
          Choose what you need below. If it‚Äôs a commission, tell us the idea and any details that help.
        </p>

        <!-- ‚úÖ CONTACT / COMMISSION FORM -->
        <form class="form" id="contactForm">
          <label>
            Your name
            <input name="name" required />
          </label>

          <label>
            Your email
            <input name="email" type="email" required />
          </label>

          <label>
            What is this about?
            <select name="type" required>
              <option value="commission" selected>Commission request</option>
              <option value="sales">Sales / buying artwork</option>
              <option value="general">General enquiry</option>
            </select>
          </label>

          <label>
            Your message
            <textarea name="message" rows="5" required placeholder="Tell us what you‚Äôd like‚Ä¶"></textarea>
          </label>

          <button class="btn" type="submit">Send</button>

          <div class="fineprint" id="formStatus" aria-live="polite"></div>
        </form>
      </div>
    </section>

  </main>

  <!-- üå∏ Japanese Footer -->
  <footer class="image-footer">
    <img src="./amelias-gallery-footer.png" alt="Footer">
    <div class="footer-note">
      Site managed by family ‚Ä¢ Supported by Uncle G & Del üíõ
    </div>
  </footer>

  <!-- ‚úÖ Wire to backend if config.js exists, else show friendly message -->
  <script src="./config.js"></script>
  <script>
    (function () {
      const form = document.getElementById("contactForm");
      const statusEl = document.getElementById("formStatus");
      if (!form) return;

      function setStatus(msg) {
        if (statusEl) statusEl.textContent = msg || "";
      }

      const API_BASE = (window.AMELIAS_CONFIG && window.AMELIAS_CONFIG.API_BASE) || "";
      const base = String(API_BASE).replace(/\/$/, "");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const fd = new FormData(form);
        const name = String(fd.get("name") || "").trim();
        const email = String(fd.get("email") || "").trim();
        const type = String(fd.get("type") || "commission");
        const message = String(fd.get("message") || "").trim();

        if (!name || !email || !message) {
          setStatus("Please fill in all fields.");
          return;
        }

        if (!base) {
          setStatus("Backend not set yet. Add API_BASE in config.js to enable sending.");
          return;
        }

        setStatus("Sending‚Ä¶");

        try {
          // If it's a commission, send to /commissions using 'brief'
          if (type === "commission") {
            const res = await fetch(base + "/commissions", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ name, email, brief: message }),
            });
            if (!res.ok) throw new Error("Send failed");
          } else {
            // Otherwise send to /enquiries
            const res = await fetch(base + "/enquiries", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ name, email, message }),
            });
            if (!res.ok) throw new Error("Send failed");
          }

          form.reset();
          setStatus("Sent ‚úÖ Thank you! We‚Äôll reply soon.");
        } catch (err) {
          setStatus("Couldn‚Äôt send right now ‚ùå Please try again in a moment.");
        }
      });
    })();
  </script>
</body>
</html>
